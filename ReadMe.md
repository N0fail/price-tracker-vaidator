# Валидатор запросов для трэкера цен

Проверяет правильность переданных аргументов и перенаправляет запрос на основной сервис price-tracker

## Запуск проекта

1. скачать зависимости
    ```
    go get ./...
    ```
2. запустить сервис price-tracker
3. запустить этот сервис
      ```
      make run_server
      ```

## Доступные GRPC процедуры (идентичны price-tracker, используется один proto файл)
Доступные GRPC функции описаны в файле api/api.proto

- ProductCreate - добавляет продукт для отслеживания, аналог /add комманды бота

- PriceTimeStampAdd - добавляет запись о цене продукта, аналог /add_price комманды бота

- PriceHistory выводит историю цен продукта в хронологическом порядке, аналог /price_history комманды бота

- ProductList выводит список отслеживаемых продуктов на странице page_number с последней ценой(в хронологическом смысле), аналог /list комманды бота

- ProductDelete удаляет продукт из отслеживания, аналог /delete комманды бота

## Пример GRPC клиента

В проект добавлен пример GRPC клиента в client/client.go

Для запуска можно использовать 
```
make run_client
```

Генерацию кода по протофайлу можно выполнить с помощью 
```
make gen
```

Возможно понадобится перекомпилировать модули протобафа, для этого можно выполнить
```
make .deps
```

## SWAGGER

Для проекта также запускается сваггер по адресу http://localhost:8090/swagger/

## Примеры запросов к REST

- Получение списка продуктов с последней ценой
```
curl -X GET 'http://localhost:8090/v1/product?pageNumber=2&resultsPerPage=5&orderBy=code'
```
- Добавление продукта
```
curl -X POST localhost:8090/v1/product -d '{"code":"qwer1234", "name":"Guitar"}'
```
- Добавление цены продукта
```
curl -X PUT localhost:8090/v1/price -d '{"code":"1", "price":123, "ts":1234567}'
```
- Получение истории цен продукта
```
curl -X GET 'localhost:8090/v1/price?code=1'
```
- Удаление продукта
```
curl -X DELETE 'localhost:8090/v1/product?code=1'
```
